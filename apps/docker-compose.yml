version: "3.9"

services:
  analytics:
    image: pulsedesk-analytics
    build:
      context: ./apps/analytics-service
    container_name: pulsedesk-analytics
    environment:
      PORT: 5000
      NODE_ENV: production
    expose:
      - "5000"
    restart: unless-stopped

  backend:
    image: pulsedesk-backend
    build:
      context: ./apps/backend
    container_name: pulsedesk-backend
    environment:
      PORT: 4000
      NODE_ENV: production
      ANALYTICS_URL: ${ANALYTICS_URL}
    expose:
      - "4000"
    depends_on:
      - analytics
    restart: unless-stopped

  frontend:
    image: pulsedesk-frontend
    build:
      context: ./apps/frontend
    container_name: pulsedesk-frontend
    environment:
      VITE_API_BASE: ${VITE_API_BASE}
    expose:
      - "5173"
    depends_on:
      - backend
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    container_name: pulsedesk-nginx
    ports:
      - "80:80"
    volumes:
      - ./infra/nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - frontend
      - backend
    restart: unless-stopped
